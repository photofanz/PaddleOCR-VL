<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaddleOCR-VL Deployment Guide | MacBook Pro M3 Max</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Inter å­—é«” -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f3f4f6; /* æ·ºç°è‰²èƒŒæ™¯ */
        }
        /* <details> æ¨™è¨˜çš„æ¨£å¼ */
        details > summary {
            list-style: none;
            cursor: pointer;
            padding: 0.75rem 1rem;
            background-color: #f9fafb; /* æ‘˜è¦èƒŒæ™¯è‰² */
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem 0.5rem 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }
        details[open] > summary {
            border-bottom: 1px solid #e5e7eb;
        }
        details > div {
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            position: relative;
        }
        pre {
            margin: 0;
            border-radius: 0 0 0.5rem 0.5rem;
            background-color: #1f2937; /* æ·±è‰²ç¨‹å¼ç¢¼èƒŒæ™¯ */
            color: #d1d5db;
            padding: 1.25rem;
            overflow-x: auto;
        }
        code {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
        }
        /* Copy button */
        .copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #4b5563;
            color: white;
            border: none;
            border-radius: 0.375rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s;
        }
        .copy-btn:hover {
            opacity: 1;
            background-color: #374151;
        }
        /* è¤‡è£½æç¤º */
        #copy-toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: bottom 0.3s ease-in-out;
            z-index: 50;
        }
        
        /* âœ¨ æ–°æ¨£å¼ï¼šGemini æŒ‰éˆ• */
        .btn { padding: 0.6rem 1rem; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: background-color 0.2s; }
        .btn-primary { background-color: #007bff; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; }
        .btn-secondary:hover { background-color: #5a6268; }
        /* å€åˆ†å…©å€‹ Gemini åŠŸèƒ½ */
        .btn-gemini-structure { background-color: #00796B; } /* çµæ§‹åŒ– - ç¶ è‰² */
        .btn-gemini-structure:hover { background-color: #004D40; }
        .btn-gemini-summarize { background-color: #8E44AD; } /* ç¸½çµ - ç´«è‰² */
        .btn-gemini-summarize:hover { background-color: #732d91; }
        .btn:disabled { background-color: #adb5bd; cursor: not-allowed; }

        .hidden { display: none; }
    </style>
</head>
<body class="antialiased">

    <!-- è¤‡è£½æç¤ºæ¡† -->
    <div id="copy-toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto max-w-4xl px-4 py-12">
        
        <!-- é é¦– -->
        <header class="mb-10">
            <div class="text-center mb-4">
                <a href="/" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                    â† è¿”å›æ‡‰ç”¨ç¨‹å¼
                </a>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 text-center mb-2">åœ¨ MacBook Pro M3 Max ä¸Šéƒ¨ç½² PaddleOCR-VL</h1>
            <p class="text-xl text-gray-600 text-center">ä¸€ä»½åœ¨åœ°åŒ– OCR + é›²ç«¯ Gemini çµæ§‹åŒ–çš„æ··åˆå¼å¯¦æ–½æŒ‡å—</p>
        </header>

        <!-- åŸ·è¡Œæ‘˜è¦ -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">åŸ·è¡Œæ‘˜è¦</h2>
            <p class="text-gray-700 leading-relaxed mb-4">
                æœ¬å ±å‘Šå°‡æŒ‡å°æ‚¨å®Œæˆä¸€æ¬¡æ¶æ§‹å‡ç´šï¼šå¾å…ˆå‰åŸºæ–¼ PyTorch çš„ DeepSeek-OCR æ–¹æ¡ˆï¼Œè½‰ç§»åˆ°åŸºæ–¼ PaddlePaddle çš„ `PaddleOCR-VL` æ–¹æ¡ˆã€‚æ­¤èˆ‰æ—¨åœ¨åˆ©ç”¨ PaddleOCR åœ¨å¤šèªè¨€è¾¨è­˜å’Œè¤‡é›œä½ˆå±€åˆ†ææ–¹é¢çš„å“è¶Šèƒ½åŠ›ã€‚
            </p>
            <p class="text-gray-700 leading-relaxed">
                èˆ‡ DeepSeek-OCR ä¸åŒï¼ŒPaddleOCR æœ¬èº«ä¸æ¥å—è‡ªç„¶èªè¨€æç¤ºä¾†ç”Ÿæˆ Markdownã€‚å› æ­¤ï¼Œæˆ‘å€‘å°‡æ¡ç”¨ä¸€å€‹æ›´å¼·å¤§çš„<b>æ··åˆå¼æ¶æ§‹</b>ï¼šåœ¨ M3 Max æœ¬åœ°åˆ©ç”¨ PaddleOCR é€²è¡Œç©©å®šå¯é çš„åŸå§‹æ–‡å­—æå–ï¼Œç„¶å¾Œåˆ©ç”¨ Gemini API çš„å¼·å¤§èªè¨€èƒ½åŠ›ï¼Œå°‡é€™äº›åŸå§‹æ–‡å­—æ™ºæ…§åœ°çµæ§‹åŒ–ç‚ºç²¾ç¾çš„Markdownå…§å®¹ã€‚
            </p>
        </section>

        <!-- ç¬¬ 1 ç¯€ï¼šæ¶æ§‹èˆ‡ç’°å¢ƒ -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ç¬¬ 1 ç¯€ï¼šå…¨æ–°çš„æ··åˆå¼æ¶æ§‹èˆ‡ PaddlePaddle ç’°å¢ƒ</h2>

            <div class="space-y-6">
                <!-- 1.1 ç³»çµ±æ¶æ§‹ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">1.1. æ··åˆå¼ç³»çµ±æ¶æ§‹</h3>
                    <p class="text-gray-700 mb-3 leading-relaxed">æ–°çš„æ¶æ§‹çµåˆäº†æœ¬åœ°å’Œé›²ç«¯çš„å„ªå‹¢ï¼š</p>
                    <ul class="list-disc list-outside pl-6 space-y-2 text-gray-700">
                        <li><strong>1. å‰ç«¯ (Frontend):</strong> ä¿æŒä¸è®Š (HTML/JS)ï¼Œä½†åŠŸèƒ½å¢å¼·ï¼Œå¯å‘¼å«å…©å€‹ä¸åŒçš„ Gemini åŠŸèƒ½ã€‚</li>
                        <li><strong>2. å¾Œç«¯ API (Backend API):</strong> ä¾ç„¶ä½¿ç”¨ FastAPIï¼Œä½†å…¶æ ¸å¿ƒ OCR æœå‹™å°‡è¢«æ›¿æ›ã€‚</li>
                        <li><strong>3. åœ¨åœ°æ¨ç†å¼•æ“ (Local Engine):</strong> `PaddleOCR` é‹è¡Œåœ¨ `PaddlePaddle` æ¡†æ¶ä¸Šï¼Œä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿æœ€ä½³ç©©å®šæ€§å’Œå…¼å®¹æ€§ã€‚</li>
                        <li><strong>4. é›²ç«¯çµæ§‹åŒ–å¼•æ“ (Cloud Engine):</strong> `Gemini API` (gemini-2.5-flash) è² è²¬å°‡åŸå§‹æ–‡å­—è½‰æ›ç‚º Markdown æˆ–é€²è¡Œç¸½çµã€‚</li>
                    </ul>
                </div>
                
                <!-- 1.2 ç’°å¢ƒè¨­å®š -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">1.2. å»ºç«‹ PaddlePaddle çš„ Conda ç’°å¢ƒ</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">æˆ‘å€‘å¿…é ˆå»ºç«‹ä¸€å€‹å…¨æ–°çš„ Conda ç’°å¢ƒï¼Œå› ç‚ºåº•å±¤çš„æ·±åº¦å­¸ç¿’æ¡†æ¶å·²å¾ PyTorch è®Šç‚º PaddlePaddleã€‚</p>
                    
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">1. å»ºç«‹ä¸¦å•Ÿç”¨æ–°çš„ Conda ç’°å¢ƒ</h4>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 1: å»ºç«‹ Conda ç’°å¢ƒ -->
                    <details class="mb-4">
                        <summary>
                            <span>Bash: å»ºç«‹ä¸¦å•Ÿç”¨ç’°å¢ƒ</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-1')">è¤‡è£½</button>
                            <pre><code id="code-1"># å»ºç«‹ä¸€å€‹åç‚º paddle-ocr çš„æ–°ç’°å¢ƒ
conda create -n paddle-ocr python=3.12 -y

# å•Ÿç”¨æ­¤ç’°å¢ƒ
conda activate paddle-ocr</code></pre>
                        </div>
                    </details>
                    
                    <h4 class="text-lg font-semibold text-gray-700 mb-2 mt-4">2. å®‰è£ PaddlePaddle æ ¸å¿ƒèˆ‡ä¾è³´é …</h4>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        PaddlePaddle å®˜æ–¹æä¾›äº†é‡å° Apple Silicon (arm64) çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿æœ€ä½³ç©©å®šæ€§ã€‚
                    </p>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 2: å®‰è£ä¾è³´ -->
                    <details class="mb-4">
                        <summary>
                            <span>Bash: ä½¿ç”¨ pip å®‰è£ Python å‡½å¼åº«</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-2')">è¤‡è£½</button>
                            <pre><code id="code-2"># 1. å®‰è£ PaddlePaddle æ ¸å¿ƒæ¡†æ¶ (é©ç”¨æ–¼ macOS arm64)
# é€™å°‡è‡ªå‹•åŒ…å« MPS æ”¯æ´
pip install paddlepaddle

# 2. å®‰è£ PaddleOCR å¥—ä»¶
# å»ºè­°ä½¿ç”¨ 2.7.3 æˆ–æ›´é«˜ç‰ˆæœ¬
pip install "paddleocr>=2.7.3"

# 3. å®‰è£ Web æ¡†æ¶åŠ PDF/åœ–åƒè™•ç†å·¥å…·
pip install "fastapi[all]" aiofiles PyMuPDF pillow

# 4. é—œéµä¾è³´ï¼šNumPy
# PaddleOCR éœ€è¦ NumPy é™£åˆ—ä½œç‚ºè¼¸å…¥
pip install numpy</code></pre>
                        </div>
                    </details>
                </div>
                
                <!-- è¡¨ 1 -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3 mt-6">è¡¨ 1ï¼šApple Silicon (M3 Max) ä¸Šçš„ PaddleOCR ä¾è³´æ¸…å–®</h3>
                    <div class="overflow-x-auto shadow rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¥—ä»¶</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‰ˆæœ¬</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç†ç”±èˆ‡ä¾†æº</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">python</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">3.12</td><td class="px-6 py-4 text-sm text-gray-500">ç©©å®šçš„ Python ç‰ˆæœ¬ã€‚</td></tr>
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">paddlepaddle</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">latest</td><td class="px-6 py-4 text-sm text-gray-500">æ ¸å¿ƒæ·±åº¦å­¸ç¿’æ¡†æ¶ã€‚macOS arm64 ç‰ˆæœ¬ï¼Œä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿ç©©å®šæ€§ã€‚</td></tr>
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">paddleocr</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">>=2.7.3</td><td class="px-6 py-4 text-sm text-gray-500">ä¸»è¦çš„ OCR å·¥å…·å¥—ä»¶ã€‚</td></tr>
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">numpy</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">latest</td><td class="px-6 py-4 text-sm text-gray-500">å°‡ PIL Image è½‰æ›ç‚º PaddleOCR æ‰€éœ€çš„ NumPy é™£åˆ—ã€‚</td></tr>
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">PyMuPDF</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">latest</td><td class="px-6 py-4 text-sm text-gray-500">é«˜æ•ˆèƒ½çš„ PDF è½‰åœ–åƒå‡½å¼åº«ã€‚</td></tr>
                                <tr><td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">fastapi</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">latest</td><td class="px-6 py-4 text-sm text-gray-500">å¾Œç«¯ API çš„æ ¸å¿ƒ Web æ¡†æ¶ã€‚</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¬¬ 2 ç¯€ï¼šæ ¸å¿ƒæ¨ç†å¼•æ“ -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ç¬¬ 2 ç¯€ï¼šæ ¸å¿ƒæ¨ç†å¼•æ“ï¼šé©—è­‰ PaddleOCR-VL èˆ‡ CPU æ¨¡å¼</h2>
            <div class="space-y-6">
                <!-- 2.1 é©—è­‰è…³æœ¬ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">2.1. é©—è­‰ CPU æ¨¡å¼ä¸Šçš„ PaddleOCR æ¨ç†</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        å»ºç«‹ä¸€å€‹åç‚º `verify_paddle_mps.py` çš„æ–°æª”æ¡ˆã€‚æ­¤è…³æœ¬å°‡åˆå§‹åŒ– `PaddleOCR`ï¼Œä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿ç©©å®šæ€§ï¼Œä¸¦è™•ç†å–®å¼µåœ–åƒã€‚
                    </p>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 3: MPS æ¨ç†è…³æœ¬ -->
                    <details class="mb-4">
                        <summary>
                            <span>Python: verify_paddle_mps.py</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-3')">è¤‡è£½</button>
                            <pre><code id="code-3">import paddleocr
import numpy as np
from PIL import Image
import argparse
import os

def run_ocr(image_path: str, lang: str = 'en'):
    print("Initializing PaddleOCR...")
    
    # 1. åˆå§‹åŒ– PaddleOCR
    # ä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿æœ€ä½³ç©©å®šæ€§
    # lang='en' æ”¯æ´è‹±æ–‡ã€‚å°æ–¼ä¸­æ–‡, å¯ä½¿ç”¨ 'ch_tra' (ç¹é«”) æˆ– 'ch_sim' (ç°¡é«”)
    try:
        ocr_engine = paddleocr.PaddleOCR(use_textline_orientation=True, lang=lang)
        print(f"PaddleOCR initialized. Using language: {lang}. CPU mode for stability.")
    except Exception as e:
        print(f"Failed to initialize PaddleOCR: {e}")
        print("Please check your installation...")
        ocr_engine = paddleocr.PaddleOCR(use_textline_orientation=True, lang=lang)
        print("PaddleOCR initialized on CPU.")

    # --- æ¨ç†åŸ·è¡Œ ---
    try:
        print(f"Processing image: {image_path}")
        
        # 2. è¼‰å…¥åœ–åƒä¸¦è½‰æ›ç‚º NumPy é™£åˆ—
        # PaddleOCR éœ€è¦ BGR æ ¼å¼çš„ NumPy é™£åˆ—
        image = Image.open(image_path).convert('RGB')
        image_np = np.array(image)
        # RGB -> BGR
        image_bgr = image_np[:, :, ::-1]
        
        # 3. åŸ·è¡Œ OCR
        # result æ˜¯ä¸€å€‹åˆ—è¡¨, e.g., [[[bbox], (text, confidence)], ...]
        result = ocr_engine.ocr(image_bgr, cls=True)
        
        print("\n--- Raw OCR Result (Structure) ---")
        print(result)

        # 4. æå–ç´”æ–‡å­—
        raw_text = []
        if result and result[0]:
            for line_data in result[0]:
                text = line_data[1][0] # æå–æ–‡å­—
                confidence = line_data[1][1] # æå–ä¿¡å¿ƒåº¦
                raw_text.append(text)
                print(f"  [Conf: {confidence:.2f}] {text}")
        
        print("\n--- Extracted Plain Text ---")
        print("\n".join(raw_text))

    except Exception as e:
        print(f"An error occurred during inference: {e}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Run PaddleOCR inference on a single image.")
    parser.add_argument("--image", type=str, required=True, help="Path to the input image file.")
    parser.add_argument("--lang", type=str, default="en", help="Language code (e.g., 'en', 'ch_tra').")
    args = parser.parse_args()

    if not os.path.exists(args.image):
        print(f"Error: Image file not found at {args.image}")
    else:
        run_ocr(args.image, args.lang)
</code></pre>
                        </div>
                    </details>
                </div>

                <!-- 2.2 è¼¸å‡ºæ ¼å¼çš„å·®ç•° -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">2.2. è¼¸å‡ºæ ¼å¼çš„é—œéµå·®ç•°</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        åŸ·è¡Œæ­¤è…³æœ¬ï¼Œæ‚¨æœƒç™¼ç¾ `PaddleOCR` çš„è¼¸å‡ºæ˜¯ä¸€å€‹åŒ…å«åº§æ¨™ã€æ–‡å­—å’Œä¿¡å¿ƒåº¦çš„è©³ç´°åˆ—è¡¨ã€‚
                    </p>
                    <p class="text-gray-700 bg-yellow-50 p-3 rounded-md text-yellow-800">
                        <strong>é‡è¦å€åˆ¥ï¼š</strong> `PaddleOCR` ä¸æ¥å—ã€Œè½‰æ›ç‚º Markdownã€çš„æç¤ºè©ã€‚å®ƒæä¾›çš„æ˜¯**åŸå§‹çš„ã€é«˜æº–ç¢ºåº¦çš„æ–‡å­—å’Œä½ˆå±€è³‡è¨Š**ã€‚æˆ‘å€‘å°‡æŠŠé€™äº›åŸå§‹æ–‡å­—å‚³éçµ¦ Gemini API é€²è¡Œå¾ŒçºŒçš„æ™ºæ…§æ ¼å¼åŒ–ã€‚
                    </p>
                </div>
                
                <!-- 2.3 åŸ·è¡Œé©—è­‰ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">2.3. ç¨ç«‹é©—è­‰æ¸¬è©¦</h3>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 4: åŸ·è¡Œé©—è­‰ -->
                    <details class="mb-4">
                        <summary>
                            <span>Bash: åŸ·è¡Œé©—è­‰è…³æœ¬</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-4')">è¤‡è£½</button>
                            <pre><code id="code-4"># åŸ·è¡Œè‹±æ–‡æ¨¡å‹
python verify_paddle_mps.py --image /path/to/your/image.png --lang en

# åŸ·è¡Œç¹é«”ä¸­æ–‡æ¨¡å‹ (éœ€ä¸‹è¼‰ç›¸æ‡‰æ¨¡å‹)
# python verify_paddle_mps.py --image /path/to/your/chinese_image.png --lang ch_tra</code></pre>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <!-- ç¬¬ 3 ç¯€ï¼šFastAPI å¾Œç«¯ -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ç¬¬ 3 ç¯€ï¼šå‡ç´š FastAPI å¾Œç«¯ä»¥æ”¯æ´ PaddleOCR</h2>
            <div class="space-y-6">
                <!-- 3.1 å°ˆæ¡ˆçµæ§‹ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">3.1. å°ˆæ¡ˆçµæ§‹ (ä¿æŒä¸è®Š)</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        æˆ‘å€‘çš„æ¨¡çµ„åŒ–çµæ§‹ä¾ç„¶é©ç”¨ï¼Œä½†æˆ‘å€‘å°‡ä¿®æ”¹ `services.py` å’Œ `main.py` çš„å…§éƒ¨é‚è¼¯ã€‚
                    </p>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 5: å°ˆæ¡ˆçµæ§‹ -->
                    <details class="mb-4">
                        <summary>
                            <span>æ–‡å­—: å°ˆæ¡ˆæª”æ¡ˆçµæ§‹</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-5')">è¤‡è£½</button>
                            <pre><code id="code-5">deepseek_ocr_app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py         # FastAPI æ‡‰ç”¨å¯¦ä¾‹ã€API è·¯ç”±
â”‚   â”œâ”€â”€ services.py     # âœ¨ æ ¸å¿ƒ OCR æœå‹™ (å·²æ›¿æ›ç‚º PaddleOCR)
â”‚   â””â”€â”€ utils.py        # PDF é è™•ç† (ä¿æŒä¸è®Š)
â”œâ”€â”€ static/             # å‰ç«¯æª”æ¡ˆ
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ script.js
â””â”€â”€ run.py              # å•Ÿå‹•è…³æœ¬ (ä¿æŒä¸è®Š)
</code></pre>
                        </div>
                    </details>
                </div>

                <!-- 3.2 PDF é è™•ç† -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">3.2. PDF é è™•ç† (app/utils.py)</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        `app/utils.py` æª”æ¡ˆä¿æŒä¸è®Šã€‚å®ƒå°‡ PDF è½‰æ›ç‚º PIL Image åˆ—è¡¨çš„åŠŸèƒ½ä»ç„¶å®Œç¾é©ç”¨ã€‚
                    </p>
                </div>

                <!-- 3.3 æ ¸å¿ƒ API -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">3.3. æ›¿æ›æ ¸å¿ƒ OCR æœå‹™ (app/services.py)</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        é€™æ˜¯æœ€å¤§çš„æ”¹å‹•ã€‚æˆ‘å€‘å°‡ `OCRService` é¡å®Œå…¨æ›¿æ›ç‚ºä½¿ç”¨ `PaddleOCR`ã€‚
                    </p>
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 6: app/services.py -->
                    <details class="mb-4">
                        <summary>
                            <span>Python: app/services.py (PaddleOCR ç‰ˆæœ¬)</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-6')">è¤‡è£½</button>
                            <pre><code id="code-6"># app/services.py
import paddleocr
import numpy as np
from PIL import Image
from typing import List
import logging

# è¨­ç½® paddleocr çš„æ—¥èªŒç´šåˆ¥ï¼Œé¿å…éå¤šçš„èª¿è©¦ä¿¡æ¯
logging.getLogger('paddleocr').setLevel(logging.ERROR)

class OCRService:
    def __init__(self):
        # è¨­å‚™å’Œæ¨¡å‹åªåœ¨æœå‹™å¯¦ä¾‹åŒ–æ™‚è¼‰å…¥ä¸€æ¬¡
        # é è¨­ä½¿ç”¨è‹±æ–‡ã€‚å¯æ ¹æ“šéœ€æ±‚æ›´æ”¹ç‚º 'ch_tra' æˆ–å…¶ä»–
        lang = 'en'
        try:
            self.ocr_engine = paddleocr.PaddleOCR(use_textline_orientation=True, lang=lang)
            print(f"PaddleOCR Service initialized on CPU with lang='{lang}'")
        except Exception as e:
            print(f"Failed to load PaddleOCR: {e}. Please check your installation.")
            self.ocr_engine = paddleocr.PaddleOCR(use_textline_orientation=True, lang=lang)
            print(f"PaddleOCR Service initialized on CPU with lang='{lang}'")

    def process_images(self, images: List[Image.Image]) -> str:
        """
        è™•ç†ä¸€å€‹ PIL Image åˆ—è¡¨ï¼Œè¿”å›åˆä½µå¾Œçš„åŸå§‹æ–‡å­—å­—ä¸²ã€‚
        """
        all_pages_text = []
        for i, image in enumerate(images):
            print(f"Processing image {i+1}/{len(images)}...")
            try:
                # 1. å°‡ PIL Image (RGB) è½‰æ›ç‚º NumPy é™£åˆ— (BGR)
                image_np = np.array(image.convert('RGB'))
                image_bgr = image_np[:, :, ::-1]
                
                # 2. åŸ·è¡Œ OCR
                result = self.ocr_engine.ocr(image_bgr, cls=True)
                
                # 3. æå–æ–‡å­—
                page_text_lines = []
                if result and result[0]:
                    for line_data in result[0]:
                        page_text_lines.append(line_data[1][0])
                
                all_pages_text.append("\n".join(page_text_lines))

            except Exception as e:
                error_message = f"\n\n---\n\n**Error processing page {i+1}:**\n`{str(e)}`\n\n---\n\n"
                all_pages_text.append(error_message)
        
        # å°‡æ‰€æœ‰é é¢çš„çµæœç”¨åˆ†éš”ç¬¦é€£æ¥èµ·ä¾†
        return "\n\n--- Page Break ---\n\n".join(all_pages_text)

# å»ºç«‹ä¸€å€‹å–®ä¾‹çš„æœå‹™å¯¦ä¾‹ï¼Œä»¥ä¾¿åœ¨æ•´å€‹æ‡‰ç”¨ç¨‹å¼ä¸­é‡è¤‡ä½¿ç”¨
ocr_service = OCRService()
</code></pre>
                        </div>
                    </details>
                    
                    <!-- ç¨‹å¼ç¢¼å€å¡Š 7: app/main.py -->
                    <details class="mb-4">
                        <summary>
                            <span>Python: app/main.py (æ›´æ–°)</span>
                            <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                        </summary>
                        <div>
                            <button class="copy-btn" onclick="copyToClipboard('code-7')">è¤‡è£½</button>
                            <pre><code id="code-7"># app/main.py
from fastapi import FastAPI, File, UploadFile, HTTPException
from fastapi.responses import HTMLResponse
from fastapi.staticfiles import StaticFiles
from .services import ocr_service # å°å…¥æ–°çš„ PaddleOCR æœå‹™
from .utils import convert_pdf_to_images
from PIL import Image
import aiofiles
import io

app = FastAPI()

app.mount("/static", StaticFiles(directory="static"), name="static")

@app.get("/", response_class=HTMLResponse)
async def read_root():
    try:
        async with aiofiles.open("static/index.html", mode='r') as f:
            content = await f.read()
        return HTMLResponse(content=content)
    except FileNotFoundError:
        return HTMLResponse(content="<h1>Frontend file not found.</h1>", status_code=404)

@app.post("/process-document/")
async def process_document(file: UploadFile = File(...)):
    if not file.content_type in ["application/pdf", "image/png", "image/jpeg"]:
        raise HTTPException(status_code=400, detail="Invalid file type.")

    contents = await file.read()
    images = []

    if file.content_type == "application/pdf":
        print("Processing PDF file...")
        images = convert_pdf_to_images(contents)
    else:
        print("Processing image file...")
        try:
            image_stream = io.BytesIO(contents)
            img = Image.open(image_stream).convert("RGB")
            images.append(img)
        except Exception as e:
            raise HTTPException(status_code=400, detail=f"Could not process image file: {e}")

    if not images:
        raise HTTPException(status_code=500, detail="Failed to extract images from the document.")

    # ä½¿ç”¨æ–°çš„ PaddleOCR æœå‹™è™•ç†åœ–åƒ
    final_raw_text = ocr_service.process_images(images)

    # è¿”å›åŒ…å«åŸå§‹æ–‡å­—çš„ JSON
    # æˆ‘å€‘ä½¿ç”¨ 'ocr_text' ä½œç‚ºéµåï¼Œä»¥å€åˆ†ä¹‹å‰çš„ 'markdown'
    return {"ocr_text": final_raw_text}
</code></pre>
                        </div>
                    </details>
                </div>
            </div>
        </section>

        <!-- ç¬¬ 4 ç¯€ï¼šå‰ç«¯ä»‹é¢ -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ç¬¬ 4 ç¯€ï¼šå‡ç´šå‰ç«¯ï¼šGemini é©…å‹•çš„çµæ§‹åŒ–</h2>
            <p class="text-gray-700 mb-4 leading-relaxed">
                å‰ç«¯ä»‹é¢æ˜¯æˆ‘å€‘æ–°æ¶æ§‹çš„é­”æ³•ç™¼ç”Ÿåœ°ã€‚æˆ‘å€‘å°‡æ–°å¢ä¸€å€‹æŒ‰éˆ•ï¼Œå°ˆé–€ç”¨æ–¼å‘¼å« Gemini API ä¾†ã€Œæ ¼å¼åŒ–ã€PaddleOCR æå–çš„åŸå§‹æ–‡å­—ã€‚
            </p>
            
            <!-- 4.1 HTML -->
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-3">4.1. HTML çµæ§‹ (static/index.html)</h3>
                <!-- ç¨‹å¼ç¢¼å€å¡Š 8: static/index.html -->
                <details class="mb-4">
                    <summary>
                        <span>HTML: static/index.html (æ›´æ–°)</span>
                        <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                    </summary>
                    <div>
                        <button class="copy-btn" onclick="copyToClipboard('code-8')">è¤‡è£½</button>
                        <pre><code id="code-8">&lt;!DOCTYPE html&gt;
&lt;html lang="zh-TW"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;PaddleOCR + Gemini&lt;/title>
    &lt;!-- å¼•å…¥ head ä¸­çš„ style æ¨™ç±¤ --&gt;
    &lt;style&gt;
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 2rem; background-color: #f8f9fa; color: #212529; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { max-width: 600px; width: 100%; background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #343a40; }
        #upload-form { display: flex; flex-direction: column; gap: 1rem; }
        #file-input-label { border: 2px dashed #dee2e6; padding: 2rem; border-radius: 8px; text-align: center; cursor: pointer; transition: border-color 0.2s; }
        #file-input-label:hover { border-color: #007bff; }
        #file-input { display: none; }
        #file-name { text-align: center; color: #495057; font-size: 0.9rem; margin-top: -0.5rem; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 0.6rem 1rem; color: white; border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer; transition: background-color 0.2s; white-space: nowrap; }
        .btn-primary { background-color: #007bff; padding: 0.75rem; font-size: 1rem; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-secondary { background-color: #6c757d; }
        .btn-secondary:hover { background-color: #5a6268; }
        .btn-gemini-structure { background-color: #00796B; } /* çµæ§‹åŒ– - ç¶ è‰² */
        .btn-gemini-structure:hover { background-color: #004D40; }
        .btn-gemini-summarize { background-color: #8E44AD; } /* ç¸½çµ - ç´«è‰² */
        .btn-gemini-summarize:hover { background-color: #732d91; }
        .btn:disabled { background-color: #adb5bd; cursor: not-allowed; }

        .progress-container { display: none; margin-top: 1rem; }
        #upload-progress { width: 100%; height: 8px; appearance: none; border: none; border-radius: 4px; overflow: hidden; }
        #upload-progress::-webkit-progress-bar { background-color: #e9ecef; }
        #upload-progress::-webkit-progress-value { background-color: #007bff; }
        #status { margin-top: 1rem; text-align: center; font-weight: 500; color: #495057; }

        .hidden { display: none; }
        #results-container { margin-top: 2rem; border-top: 1px solid #dee2e6; padding-top: 1.5rem; }
        #ocr-output { width: 100%; height: 200px; border: 1px solid #ced4da; border-radius: 4px; padding: 0.5rem; font-family: monospace; font-size: 0.85rem; }
        #controls-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; }
        
        #gemini-output-container { margin-top: 1.5rem; }
        #gemini-output-title { margin-bottom: 0.5rem; font-weight: bold; }
        #gemini-output { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 4px; padding: 1rem; min-height: 100px; white-space: pre-wrap; word-wrap: break-word; }
        #gemini-loading { text-align: center; color: #495057; }

    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;PaddleOCR æœ¬åœ°è¾¨è­˜ + Gemini é›²ç«¯æ™ºæ…§&lt;/h1&gt;
        &lt;form id="upload-form"&gt;
            &lt;label for="file-input" id="file-input-label"&gt;
                &lt;span&gt;é»æ“Šæ­¤è™•é¸æ“‡æª”æ¡ˆ&lt;/span&gt;
            &lt;/label&gt;
            &lt;input type="file" id="file-input" name="file" accept=".pdf,.png,.jpg,.jpeg" required&gt;
            &lt;div id="file-name"&gt;å°šæœªé¸æ“‡æª”æ¡ˆ&lt;/div&gt;
            &lt;button type="submit" id="submit-btn" class="btn btn-primary" disabled&gt;é–‹å§‹ OCR è¾¨è­˜&lt;/button&gt;
        &lt;/form&gt;
        &lt;div class="progress-container" id="progress-container"&gt;
            &lt;progress id="upload-progress" value="0" max="100"&gt;&lt;/progress&gt;
        &lt;/div&gt;
        &lt;div id="status"&gt;è«‹é¸æ“‡ä¸€å€‹ PDF æˆ–åœ–åƒæª”æ¡ˆ&lt;/div&gt;

        &lt;!-- âœ¨ æ›´æ–°çš„çµæœå€åŸŸ --&gt;
        &lt;div id="results-container" class="hidden"&gt;
            &lt;h2 style="text-align: center; margin-bottom: 1rem;"&gt;PaddleOCR åŸå§‹è¾¨è­˜çµæœ&lt;/h2&gt;
            &lt;textarea id="ocr-output" readonly&gt;&lt;/textarea&gt;
            
            &lt;div id="controls-container"&gt;
                &lt;button id="download-btn" class="btn btn-secondary"&gt;ä¸‹è¼‰åŸå§‹æ–‡å­—&lt;/button&gt;
                &lt;!-- âœ¨ æ–°å¢çš„çµæ§‹åŒ–æŒ‰éˆ• --&gt;
                &lt;button id="structure-btn" class="btn btn-gemini-structure"&gt;âœ¨ çµæ§‹åŒ–ç‚º Markdown (Gemini)&lt;/button&gt;
                &lt;button id="summarize-btn" class="btn btn-gemini-summarize"&gt;âœ¨ ç¸½çµå…§å®¹ (Gemini)&lt;/button&gt;
            &lt;/div&gt;
            
            &lt;div id="gemini-output-container" class="hidden"&gt;
                &lt;h3 id="gemini-output-title"&gt;Gemini çµæœ:&lt;/h3&gt;
                &lt;div id="gemini-loading" class="hidden"&gt;
                    &lt;p&gt;ğŸ¤– æ­£åœ¨è«‹æ±‚ Gemini API (gemini-2.5-flash)ï¼Œè«‹ç¨å€™...&lt;/p&gt;
                &lt;/div&gt;
                &lt;div id="gemini-output"&gt;&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;script src="/static/script.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
                </details>
            </div>
            
            <!-- 4.2 JS -->
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-3">4.2. JavaScript é‚è¼¯ (static/script.js)</h3>
                <p class="text-gray-700 mb-4 leading-relaxed">
                    `script.js` æª”æ¡ˆç¾åœ¨å°‡ç®¡ç†ä¸‰å€‹ä¸»è¦åŠŸèƒ½ï¼šä¸‹è¼‰ã€çµæ§‹åŒ–å’Œç¸½çµã€‚
                </p>
                <!-- ç¨‹å¼ç¢¼å€å¡Š 9: static/script.js -->
                <details class="mb-4">
                    <summary>
                        <span>JavaScript: static/script.js (æ›´æ–°)</span>
                        <span class="text-sm font-normal text-gray-500">å±•é–‹/æ”¶åˆ</span>
                    </summary>
                    <div>
                        <button class="copy-btn" onclick="copyToClipboard('code-9')">è¤‡è£½</button>
                        <pre><code id="code-9">document.addEventListener('DOMContentLoaded', () => {
    const uploadForm = document.getElementById('upload-form');
    const fileInput = document.getElementById('file-input');
    const fileNameDiv = document.getElementById('file-name');
    const submitBtn = document.getElementById('submit-btn');
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('upload-progress');
    const statusDiv = document.getElementById('status');
    let selectedFile = null;

    // âœ¨ ç²å–æ–°çš„ UI å…ƒç´ 
    const resultsContainer = document.getElementById('results-container');
    const ocrOutput = document.getElementById('ocr-output'); // é‡å‘½å textarea
    const downloadBtn = document.getElementById('download-btn');
    const structureBtn = document.getElementById('structure-btn'); // âœ¨ æ–°æŒ‰éˆ•
    const summarizeBtn = document.getElementById('summarize-btn');
    const geminiOutputContainer = document.getElementById('gemini-output-container');
    const geminiOutputTitle = document.getElementById('gemini-output-title');
    const geminiLoading = document.getElementById('gemini-loading');
    const geminiOutput = document.getElementById('gemini-output');

    let currentOcrText = ""; // âœ¨ å„²å­˜åŸå§‹ OCR çµæœ

    // ç³»çµ±æç¤ºè©
    const PROMPT_SUMMARIZE = "ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„ç¸½çµåŠ©æ‰‹ã€‚è«‹ç‚ºä»¥ä¸‹ OCR è¾¨è­˜å‡ºçš„å…§å®¹æä¾›ä¸€å€‹ç°¡æ½”ã€æº–ç¢ºã€æ¢åˆ—å¼çš„ç¸½çµã€‚";
    const PROMPT_STRUCTURE = "ä½ æ˜¯ä¸€å€‹å¼·å¤§çš„æ–‡ä»¶æ ¼å¼åŒ–åŠ©æ‰‹ã€‚è«‹å°‡ä»¥ä¸‹é€™ä»½ç”± OCR æå–çš„åŸå§‹æ–‡å­—ï¼Œè½‰æ›ç‚ºçµæ§‹è‰¯å¥½ã€æ˜“æ–¼é–±è®€çš„ Markdown æ–‡ä»¶ã€‚ä½ éœ€è¦ä¿ç•™æ‰€æœ‰å…§å®¹ï¼Œä½†è¦æº–ç¢ºåœ°åŠ ä¸Šæ¨™é¡Œã€åˆ—è¡¨ã€æ®µè½å’Œä»£ç¢¼å¡Šç­‰æ ¼å¼ã€‚";

    fileInput.addEventListener('change', (event) => {
        selectedFile = event.target.files[0];
        if (selectedFile) {
            fileNameDiv.textContent = selectedFile.name;
            statusDiv.textContent = 'æª”æ¡ˆå·²æº–å‚™å°±ç·’ã€‚';
            submitBtn.disabled = false;
        } else {
            fileNameDiv.textContent = 'å°šæœªé¸æ“‡æª”æ¡ˆ';
            statusDiv.textContent = 'è«‹é¸æ“‡ä¸€å€‹ PDF æˆ–åœ–åƒæª”æ¡ˆ';
            submitBtn.disabled = true;
        }
    });

    uploadForm.addEventListener('submit', (event) => {
        event.preventDefault();
        if (!selectedFile) return;

        submitBtn.disabled = true;
        submitBtn.textContent = 'è™•ç†ä¸­...';
        progressContainer.style.display = 'block';
        progressBar.value = 0;
        statusDiv.textContent = 'æ­£åœ¨ä¸Šå‚³æª”æ¡ˆ...';
        statusDiv.style.color = '#495057';
        
        // éš±è—èˆŠçµæœ
        resultsContainer.classList.add('hidden');
        geminiOutputContainer.classList.add('hidden');

        const formData = new FormData();
        formData.append('file', selectedFile);

        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/process-document/', true);
        xhr.responseType = 'json';

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                progressBar.value = percentComplete;
                if (percentComplete >= 100) {
                    statusDiv.textContent = 'æª”æ¡ˆä¸Šå‚³å®Œæˆï¼ŒPaddleOCR æ­£åœ¨æœ¬åœ°è¾¨è­˜...';
                }
            }
        };

        xhr.onload = () => {
            if (xhr.status === 200) {
                const data = xhr.response;
                // âœ¨ æ¥æ”¶ 'ocr_text' éµ
                if (data && data.ocr_text) {
                    currentOcrText = data.ocr_text;
                    ocrOutput.value = currentOcrText;
                    resultsContainer.classList.remove('hidden');
                    statusDiv.textContent = 'è¾¨è­˜å®Œæˆã€‚æ‚¨ç¾åœ¨å¯ä»¥ä¸‹è¼‰æˆ–ä½¿ç”¨ Gemini è™•ç†ã€‚';
                } else {
                    statusDiv.textContent = 'éŒ¯èª¤ï¼šå¾ä¼ºæœå™¨æ”¶åˆ°ç„¡æ•ˆçš„éŸ¿æ‡‰ã€‚';
                    statusDiv.style.color = 'red';
                }
            } else {
                try {
                    const errorData = xhr.response;
                    statusDiv.textContent = `éŒ¯èª¤: ${errorData.detail || 'æœªçŸ¥éŒ¯èª¤'}`;
                } catch (e) {
                     statusDiv.textContent = `ä¼ºæœå™¨éŒ¯èª¤ (ç‹€æ…‹ç¢¼: ${xhr.status})`;
                }
                statusDiv.style.color = 'red';
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'é–‹å§‹ OCR è¾¨è­˜';
            progressContainer.style.display = 'none';
        };

        xhr.onerror = ()_ => {
            statusDiv.textContent = 'ç™¼ç”Ÿç¶²çµ¡éŒ¯èª¤ï¼Œè«‹é‡è©¦ã€‚';
            statusDiv.style.color = 'red';
            resetUI();
        };

        xhr.send(formData);
    });

    // ä¸‹è¼‰æŒ‰éˆ•
    downloadBtn.addEventListener('click', () => {
        if (!currentOcrText || !selectedFile) return;

        const blob = new Blob([currentOcrText], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        const originalFilename = selectedFile.name.substring(0, selectedFile.name.lastIndexOf('.')) || selectedFile.name;
        a.download = `raw_text_${originalFilename}.txt`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    });

    // âœ¨ çµæ§‹åŒ–æŒ‰éˆ•
    structureBtn.addEventListener('click', () => {
        if (!currentOcrText) return;
        geminiOutputTitle.textContent = "Gemini çµæ§‹åŒ– (Markdown) çµæœ:";
        triggerGeminiAction(currentOcrText, PROMPT_STRUCTURE, structureBtn);
    });

    // ç¸½çµæŒ‰éˆ•
    summarizeBtn.addEventListener('click', () => {
        if (!currentOcrText) return;
        geminiOutputTitle.textContent = "Gemini ç¸½çµçµæœ:";
        triggerGeminiAction(currentOcrText, PROMPT_SUMMARIZE, summarizeBtn);
    });

    async function triggerGeminiAction(text, systemPrompt, buttonElement) {
        geminiLoading.classList.remove('hidden');
        geminiOutputContainer.classList.remove('hidden');
        geminiOutput.classList.add('hidden');
        buttonElement.disabled = true;
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'âœ¨ è™•ç†ä¸­...';

        try {
            const result = await callGeminiAPI(text, systemPrompt);
            geminiOutput.textContent = result;
        } catch (error) {
            console.error(error);
            geminiOutput.textContent = `Gemini API è«‹æ±‚å¤±æ•—ï¼š${error.message}`;
        } finally {
            geminiLoading.classList.add('hidden');
            geminiOutput.classList.remove('hidden');
            buttonElement.disabled = false;
            buttonElement.textContent = originalText;
        }
    }

    async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(url, options);
                if (response.status === 429 || response.status >= 500) {
                    throw new Error(`Server error or rate limit: ${response.status}`);
                }
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                return response.json();
            } catch (error) {
                console.warn(`Attempt ${i + 1} failed: ${error.message}. Retrying in ${delay}ms...`);
                if (i < retries - 1) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // æŒ‡æ•¸é€€é¿
                } else {
                    throw error;
                }
            }
        }
    }

    async function callGeminiAPI(textToProcess, systemPromptText) {
        const userQuery = `è«‹è™•ç†ä»¥ä¸‹æ–‡å­—ï¼š\n\n"""\n${textToProcess}\n"""`;
        const apiKey = ""; // ä¾ç…§æŒ‡ç¤ºï¼Œå°‡ API é‡‘é‘°ä¿ç•™ç‚ºç©ºå­—ä¸²
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: {
                parts: [{ text: systemPromptText }]
            },
        };

        const options = {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        };

        const result = await fetchWithRetry(apiUrl, options);

        if (result.candidates && result.candidates[0].content?.parts?.[0]?.text) {
            return result.candidates[0].content.parts[0].text;
        } else {
            console.error("Invalid response structure from Gemini API:", result);
            throw new Error("å¾ Gemini API æ”¶åˆ°çš„éŸ¿æ‡‰æ ¼å¼ä¸æ­£ç¢ºã€‚");
        }
    }

    function resetUI() {
        submitBtn.disabled = true;
        submitBtn.textContent = 'é–‹å§‹ OCR è¾¨è­˜';
        progressContainer.style.display = 'none';
        uploadForm.reset();
        fileNameDiv.textContent = 'å°šæœªé¸æ“‡æª”æ¡ˆ';
        selectedFile = null;
        resultsContainer.classList.add('hidden');
        geminiOutputContainer.classList.add('hidden');
        currentOcrText = "";
    }
});
</code></pre>
                </div>
            </div>
        </section>
        
        <!-- ç¬¬ 5 ç¯€ï¼šæ•ˆèƒ½èˆ‡æœªä¾† -->
        <section class="bg-white shadow-lg rounded-lg p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">ç¬¬ 5 ç¯€ï¼šæ•ˆèƒ½çµè«–èˆ‡æ··åˆå¼æ¶æ§‹çš„æœªä¾†</h2>
            <div class="space-y-6">
                <!-- 5.1 æ•ˆèƒ½åˆ†æ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">5.1. M3 Max ä¸Šçš„æ•ˆèƒ½åˆ†æ</h3>
                    <ul class="list-disc list-outside pl-6 space-y-2 text-gray-700">
                        <li><strong>æœ¬åœ° OCR æ•ˆèƒ½:</strong> `PaddlePaddle` æ¡†æ¶åœ¨ Apple Silicon ä¸Šé‹è¡Œç©©å®šã€‚ä½¿ç”¨ CPU æ¨¡å¼ç¢ºä¿æœ€ä½³å…¼å®¹æ€§ï¼Œè™•ç†é€Ÿåº¦ä¾ç„¶å„ªç§€ï¼Œé©åˆå¤§å¤šæ•¸æ‡‰ç”¨å ´æ™¯ã€‚</li>
                        <li><strong>è¨˜æ†¶é«”ä½”ç”¨:</strong> PaddleOCR çš„æ¨¡å‹ç›¸è¼ƒæ–¼å¤§å‹ VLMs æ›´ç‚ºè¼•é‡ï¼Œåœ¨ M3 Max çš„çµ±ä¸€è¨˜æ†¶é«”ä¸Šé‹è¡Œç¶½ç¶½æœ‰é¤˜ï¼Œç¢ºä¿äº† API æœå‹™çš„ä½å»¶é²éŸ¿æ‡‰ã€‚</li>
                        <li><strong>æ··åˆå¼æ¶æ§‹çš„å„ªå‹¢:</strong> æ­¤æ¶æ§‹æ˜¯ç›®å‰æœ€å…©å…¨å…¶ç¾çš„æ–¹æ¡ˆã€‚å®ƒåˆ©ç”¨æœ¬åœ°ç¡¬é«”è™•ç†æœ€è€—æ™‚ã€è³‡æ–™é‡æœ€å¤§çš„ OCR ä»»å‹™ (å°‡åœ–åƒè½‰ç‚ºæ–‡å­—)ï¼ŒåŒæ™‚åˆ©ç”¨é›²ç«¯ Gemini API è™•ç†æœ€éœ€è¦æ™ºæ…§çš„ã€åŸºæ–¼èªè¨€æ¨¡å‹çš„ä»»å‹™ (çµæ§‹åŒ–èˆ‡ç¸½çµ)ã€‚</li>
                    </ul>
                </div>

                <!-- 5.2 çµè«–èˆ‡æœªä¾†æ–¹å‘ -->
                <div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">5.2. çµè«–èˆ‡æœªä¾†æ–¹å‘</h3>
                    <p class="text-gray-700 mb-4 leading-relaxed">
                        æˆ‘å€‘æˆåŠŸåœ°å°‡æ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒå¾ DeepSeek-OCR é·ç§»åˆ°äº† PaddleOCR-VLï¼Œä¸¦å»ºç«‹äº†ä¸€å€‹æ›´å¼·å¤§ã€æ›´éˆæ´»çš„æ··åˆå¼ç³»çµ±ã€‚æ­¤ç³»çµ±çµåˆäº† M3 Max çš„æœ¬åœ°é‹ç®—èƒ½åŠ›å’Œ Gemini API çš„é›²ç«¯æ™ºæ…§ã€‚
                    </p>
                    <h4 class="text-lg font-semibold text-gray-700 mb-2">æœªä¾†å¯è¡Œçš„æ“´å±•æ–¹å‘åŒ…æ‹¬ï¼š</h4>
                    <ul class="list-disc list-outside pl-6 space-y-2 text-gray-700">
                        <li><strong>å‹•æ…‹èªè¨€é¸æ“‡:</strong> åœ¨å‰ç«¯å¢åŠ ä¸€å€‹ä¸‹æ‹‰é¸å–®ï¼Œå…è¨±ä½¿ç”¨è€…é¸æ“‡ OCR èªè¨€ (å¦‚ 'en', 'ch_tra', 'ja')ï¼Œä¸¦å°‡å…¶å‚³éçµ¦å¾Œç«¯ï¼Œå¾Œç«¯å‹•æ…‹åˆå§‹åŒ– `PaddleOCR(lang=...)`ã€‚</li>
                        <li><strong>è¡¨æ ¼çµæ§‹åŒ–:</strong> åˆ©ç”¨ PaddleOCR å¼·å¤§çš„ `structure` æ¨¡å¼ (ä½ˆå±€åˆ†æ) ä¾†å°ˆé–€è™•ç†è¡¨æ ¼ã€‚å¯ä»¥æå–è¡¨æ ¼çš„ HTML çµæ§‹ï¼Œä¸¦å°‡å…¶èˆ‡ Gemini çš„æ ¼å¼åŒ–èƒ½åŠ›ç›¸çµåˆã€‚</li>
                        <li><strong>Gemini æ¨¡å‹çš„é¸æ“‡:</strong> å…è¨±ä½¿ç”¨è€…åœ¨ `gemini-2.5-flash` (å¿«é€Ÿ) å’Œ `gemini-pro` (é«˜å“è³ª) ä¹‹é–“åˆ‡æ›ï¼Œä»¥æ‡‰å°ä¸åŒçš„ä»»å‹™éœ€æ±‚ã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- é è…³ -->
        <footer class="text-center mt-12">
            <p class="text-gray-500">æ··åˆå¼ AI éƒ¨ç½²æŒ‡å—</p>
        </footer>

    </div> <!-- /container -->

    <script>
        // è¤‡è£½åˆ°å‰ªè²¼ç°¿çš„å‡½æ•¸
        function copyToClipboard(elementId) {
            const codeEl = document.getElementById(elementId);
            const text = codeEl.innerText;
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            } catch (err) {
                console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
                showToast('è¤‡è£½å¤±æ•—ï¼');
            }
            document.body.removeChild(textArea);
        }

        // é¡¯ç¤ºæç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('copy-toast');
            toast.textContent = message;
            toast.style.bottom = '20px'; // é¡¯ç¤º
            setTimeout(() => {
                toast.style.bottom = '-100px'; // éš±è—
            }, 2000);
        }
    </script>
</body>
</html>


